ruleId: opnrvn-r-85
type: asset
ruleName: >
  Ensure that VPC Flow Logs is enabled for every subnet in a VPC Network
description: >
  Flow Logs is a feature that enables users to capture information about the IP traffic going to and from network interfaces in the organization's VPC Subnets.
  Once a flow log is created, the user can view and retrieve its data in Stackdriver Logging.
  It is recommended that Flow Logs be enabled for every business-critical VPC subnet.
severity: high
enabled: true
sql: >
  SELECT distinct acc.asset_id
   FROM assets acc,
   LATERAL (
       SELECT value ->> 'enableFlowLogs' as efl, value ->> 'purpose' as prp
       FROM jsonb_array_elements(supplementary_configuration -> 'subnetworks')
   ) arr
  WHERE acc.resource_type = 'GCP::VPC::Network'
    AND (efl = 'false' OR efl IS NULL)
    AND prp = 'PRIVATE'

remediationDocURLs: https://github.com/openraven/security-rules/wiki
version: 0.9