# id: a93a546f-00c5-4a6d-8266-3e41480d400e
ruleId: opnrvn-r-10
type: asset
ruleName: >
  Ensure VPC flow logging is enabled in all VPCs
description: >
  VPC Flow Logs is a feature that enables you to capture information about the IP traffic
  going to and from network interfaces in your VPC. After you've created a flow log, you can
  view and retrieve its data in Amazon CloudWatch Logs. It is recommended that VPC Flow
  Logs be enabled for packet "Rejects" for VPCs.
severity: high
enabled: true
sql: >
  SELECT asset_id
  FROM assets
  WHERE resource_type = 'AWS::EC2::VPC'
    AND asset_id NOT IN
      (SELECT asset_id
       FROM
         (SELECT asset_id,
                 jsonb_array_elements(supplementary_configuration->'flowLogs'->'flowLogs') AS flow_logs
          FROM assets
          WHERE resource_type = 'AWS::EC2::VPC') flow_logs_table
       WHERE flow_logs->>'flowLogStatus' ILIKE 'ACTIVE'
         AND (flow_logs->>'trafficType' ILIKE 'ALL'
              OR flow_logs->>'trafficType' ILIKE 'REJECT'));
remediationDocURLs: https://github.com/openraven/security-rules/wiki
version: 0.9
