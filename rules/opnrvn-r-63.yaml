# id: 419ab56b-0837-4bc8-a04d-b0e184dc2303
ruleId: opnrvn-r-63
type: asset
ruleName: >
  Ensure that there are only GCP-managed service account keys for each service account
description: >
  User managed service accounts should not have user-managed keys
severity: high
enabled: true
sql: >
  SELECT key ->> 'name' as asset_id
  FROM
    (SELECT jsonb_array_elements(supplementary_configuration->'keys'->'keys') AS key
       FROM assets
      WHERE resource_type = 'GCP::Iam::ServiceAccount') AS keys
  WHERE key->>'keyType' = 'USER_MANAGED';

remediationDocURLs: https://github.com/openraven/security-rules/wiki
version: 0.9
