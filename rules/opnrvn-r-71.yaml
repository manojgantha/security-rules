ruleId: opnrvn-r-71
type: asset
ruleName: >
  Ensure that Separation of duties is enforced while assigning KMS related roles to users
description: >
  Separation of duties is the concept of ensuring that one individual does not have all necessary permissions to be able to complete a malicious action.
  In Cloud KMS, this could be an action such as using a key to access and decrypt data a user should not normally have access to
severity: high
enabled: true
sql: >
  SELECT members AS asset_id
  FROM assets acc,
  LATERAL (
        SELECT value ->> 'role_' AS roles, jsonb_array_elements_text(value -> 'members_') AS members
        FROM jsonb_array_elements(supplementary_configuration -> 'iamPolicy' -> 'bindings_')
    ) arr
  WHERE acc.resource_type = 'GCP::ResourceManager::Project'
    AND roles ilike '%cloudkms.admin%'
remediationDocURLs: https://github.com/openraven/security-rules/wiki
version: 0.9
