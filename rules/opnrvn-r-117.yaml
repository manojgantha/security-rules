ruleId: opnrvn-r-117
type: asset
ruleName: >
  Ensure that the 'log_checkpoints' database flag for Cloud SQL PostgreSQL instance is set to 'on'
description: >
  Enabling log_checkpoints causes checkpoints and restart points to be logged in the server log.
  Some statistics are included in the log messages, including the number of buffers written and the time spent writing them.
  By default log_checkpoints is off.
severity: high
enabled: true
sql: >
  SELECT acc.asset_id
    FROM assets acc
   WHERE resource_type = 'GCP::SQL::Instance'
     AND acc."configuration" ->> 'databaseVersion' ILIKE 'POSTGRES%'
     AND NOT EXISTS (
      SELECT value
        FROM jsonb_array_elements(acc."configuration" -> 'settings' -> 'databaseFlags')
       WHERE value ->> 'name' = 'log_checkpoints' AND value ->> 'value' = 'on'
     )
remediationDocURLs: https://github.com/openraven/security-rules/wiki
version: 0.9