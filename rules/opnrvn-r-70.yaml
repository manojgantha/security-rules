ruleId: opnrvn-r-70
type: asset
ruleName: >
  Ensure KMS encryption keys are rotated within a period of 90 days
description: >
  A key is used to protect some corpus of data.
  A collection of files could be encrypted with the same key and people with decrypt permissions on that key would be able to decrypt those files.
  Therefore, it's necessary to make sure the rotation period is set to a specific time
  By default, KMS encryption keys are rotated every 90 days (7776000 seconds)
severity: high
enabled: true
sql: >
  SELECT acc.asset_id as asset_id
    FROM assets acc,
    LATERAL (
        SELECT value -> 'rotationSchedule_' ->> 'seconds_' as kms_rotation
        FROM jsonb_array_elements(supplementary_configuration -> 'keys')
    ) arr
   WHERE acc.resource_type = 'GCP::KMS::Keyring' AND arr.kms_rotation::numeric > 7776000
remediation: >
  From Console
    1. Go to Cryptographic Keys by visiting: https://console.cloud.google.com/security/kms.
    2. Click on the specific key ring
    3. From the list of keys, choose the specific key and Click on Right side pop up the
    blade (3 dots).
    4. Click on Edit rotation period.
    5. On the pop-up window, Select a new rotation period in days which should be
    less than 90 and then choose Starting on date (date from which the rotation period begins).
remediationDocURLs: https://github.com/openraven/security-rules/wiki
version: 0.9
