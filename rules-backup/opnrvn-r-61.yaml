ruleId: opnrvn-r-61
type: asset
ruleName: >
  Ensure oslogin is enabled for a Project
description: >
  Enabling OS login binds SSH certificates to IAM users and facilitates effective SSH certificate management.
severity: high
enabled: true
sql: >
  SELECT acc.asset_id
    FROM magpie.assets acc
   WHERE acc.resource_type = 'GCP::Project::Info'
     AND NOT EXISTS
            (SELECT value as val
               FROM jsonb_array_elements("configuration" -> 'commonInstanceMetadata' -> 'items')
              WHERE value ->> 'key' = 'enable-osconfig'
                AND lower(value ->> 'value') = 'true')

remediationDocURLs: https://github.com/openraven/security-rules/wiki
version: 0.9