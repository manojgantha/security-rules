ruleId: opnrvn-r-111
type: asset
ruleName: >
  Ensure that BigQuery datasets are not anonymously or publicly accessible
description: >
  It is recommended that the IAM policy on BigQuery datasets does not allow anonymous and/or public access.
  Granting permissions to allUsers or allAuthenticatedUsers allows anyone to access the dataset.
  Such access might not be desirable if sensitive data is being stored in the dataset.
  Therefore, ensure that anonymous and/or public access to a dataset is not allowed.
severity: high
enabled: true
sql: >
  SELECT acc.asset_id
    FROM assets acc
   WHERE acc.resource_type = 'GCP::BigQuery::Dataset'
     AND EXISTS (
       SELECT *
         FROM jsonb_array_elements(acc.configuration -> 'acl')
        WHERE value ->> 'entity' ILIKE '%allAuthenticatedUsers%'
           OR value ->> 'entity' ILIKE '%allUsers%'
     )
remediationDocURLs: https://github.com/openraven/security-rules/wiki
version: 0.9