#opnrnv-r-147
ruleId: aws-compute-ec2-imdsv2-check
cloudProvider: aws
description: >
  Insecure Assets:
   - `no-imdsv2` Not Configured with IMDSv2.
  Secure asset
   - `with-imdsv2` Properly Configured with IMDSv2.
insecureAssets:
  no-imdsv2: >
    [ {
      "documentId" : "3ZXZRujdMHSm4LIB7GGfHA",
      "arn" : "no-imdsv2",
      "resourceName" : "no-imdsv2",
      "resourceId" : "no-imdsv2",
      "resourceType" : "AWS::EC2::Instance",
      "awsRegion" : "us-east-1",
      "awsAccountId" : "",
      "createdIso" : "2021-11-28T19:50:25Z",
      "updatedIso" : "2021-11-30T15:30:14.463143Z",
      "discoverySessionId" : null,
      "maxSizeInBytes" : null,
      "sizeInBytes" : null,
      "configuration" : {
        "amiLaunchIndex" : 0,
        "imageId" : "ami-04902260ca3d33422",
        "instanceId" : "",
        "instanceType" : "t2.micro",
        "kernelId" : null,
        "keyName" : "",
        "launchTime" : "2021-11-28T19:50:25Z",
        "monitoring" : {
          "state" : "disabled"
        },
        "placement" : {
          "availabilityZone" : "us-east-1d",
          "affinity" : null,
          "groupName" : "",
          "partitionNumber" : null,
          "hostId" : null,
          "tenancy" : "default",
          "spreadDomain" : null,
          "hostResourceGroupArn" : null
        },
        "platform" : null,
        "privateDnsName" : "",
        "privateIpAddress" : "",
        "productCodes" : [ ],
        "publicDnsName" : "",
        "publicIpAddress" : "",
        "ramdiskId" : null,
        "state" : {
          "code" : 16,
          "name" : "running"
        },
        "stateTransitionReason" : "",
        "subnetId" : "",
        "vpcId" : "",
        "architecture" : "x86_64",
        "blockDeviceMappings" : [ {
          "deviceName" : "/dev/xvda",
          "ebs" : {
            "attachTime" : "2021-11-28T19:50:26Z",
            "deleteOnTermination" : true,
            "status" : "attached",
            "volumeId" : ""
          }
        } ],
        "clientToken" : "",
        "ebsOptimized" : false,
        "enaSupport" : true,
        "hypervisor" : "xen",
        "iamInstanceProfile" : null,
        "instanceLifecycle" : null,
        "elasticGpuAssociations" : null,
        "elasticInferenceAcceleratorAssociations" : null,
        "networkInterfaces" : [ {
          "association" : {
            "carrierIp" : null,
            "ipOwnerId" : "amazon",
            "publicDnsName" : "",
            "publicIp" : ""
          },
          "attachment" : {
            "attachTime" : "2021-11-28T19:50:25Z",
            "attachmentId" : "",
            "deleteOnTermination" : true,
            "deviceIndex" : 0,
            "status" : "attached",
            "networkCardIndex" : 0
          },
          "description" : "",
          "groups" : [ {
            "groupName" : "",
            "groupId" : ""
          } ],
          "ipv6Addresses" : [ ],
          "macAddress" : "",
          "networkInterfaceId" : "",
          "ownerId" : "",
          "privateDnsName" : "",
          "privateIpAddress" : "",
          "privateIpAddresses" : [ {
            "association" : {
              "carrierIp" : null,
              "ipOwnerId" : "amazon",
              "publicDnsName" : "",
              "publicIp" : ""
            },
            "primary" : true,
            "privateDnsName" : "",
            "privateIpAddress" : ""
          } ],
          "sourceDestCheck" : true,
          "status" : "in-use",
          "subnetId" : "",
          "vpcId" : "",
          "interfaceType" : "interface"
        } ],
        "outpostArn" : null,
        "rootDeviceName" : "/dev/xvda",
        "rootDeviceType" : "ebs",
        "securityGroups" : [ {
          "groupName" : "",
          "groupId" : ""
        } ],
        "sourceDestCheck" : true,
        "spotInstanceRequestId" : null,
        "sriovNetSupport" : null,
        "stateReason" : null,
        "tags" : [ {
          "key" : "Name",
          "value" : ""
        } ],
        "virtualizationType" : "hvm",
        "cpuOptions" : {
          "coreCount" : 1,
          "threadsPerCore" : 1
        },
        "capacityReservationId" : null,
        "capacityReservationSpecification" : {
          "capacityReservationPreference" : "open",
          "capacityReservationTarget" : null
        },
        "hibernationOptions" : {
          "configured" : false
        },
        "licenses" : null,
        "metadataOptions" : {
          "state" : "applied",
          "httpTokens" : "optional",
          "httpPutResponseHopLimit" : 1,
          "httpEndpoint" : "enabled"
        },
        "enclaveOptions" : {
          "enabled" : false
        },
        "publicIp" : ""
      },
      "supplementaryConfiguration" : {
        "awsBackupJobs" : [ ]
      },
      "tags" : {
        "Name" : ""
      },
      "discoveryMeta" : { }
    }]
secureAssets:
  with-imdsv2: >
    [ {
          "documentId" : "3ZXZRujdMHSm4LIB7GGfHA",
          "arn" : "with-imdsv2",
          "resourceName" : "with-imdsv2",
          "resourceId" : "with-imdsv2",
          "resourceType" : "AWS::EC2::Instance",
          "awsRegion" : "us-east-1",
          "awsAccountId" : "",
          "createdIso" : "2021-11-28T19:50:25Z",
          "updatedIso" : "2021-11-30T15:30:14.463143Z",
          "discoverySessionId" : null,
          "maxSizeInBytes" : null,
          "sizeInBytes" : null,
          "configuration" : {
            "amiLaunchIndex" : 0,
            "imageId" : "ami-04902260ca3d33422",
            "instanceId" : "",
            "instanceType" : "t2.micro",
            "kernelId" : null,
            "keyName" : "",
            "launchTime" : "2021-11-28T19:50:25Z",
            "monitoring" : {
              "state" : "enabled"
            },
            "placement" : {
              "availabilityZone" : "us-east-1d",
              "affinity" : null,
              "groupName" : "",
              "partitionNumber" : null,
              "hostId" : null,
              "tenancy" : "default",
              "spreadDomain" : null,
              "hostResourceGroupArn" : null
            },
            "platform" : null,
            "privateDnsName" : "",
            "privateIpAddress" : "",
            "productCodes" : [ ],
            "publicDnsName" : "",
            "publicIpAddress" : "",
            "ramdiskId" : null,
            "state" : {
              "code" : 16,
              "name" : "running"
            },
            "stateTransitionReason" : "",
            "subnetId" : "",
            "vpcId" : "",
            "architecture" : "x86_64",
            "blockDeviceMappings" : [ {
              "deviceName" : "/dev/xvda",
              "ebs" : {
                "attachTime" : "2021-11-28T19:50:26Z",
                "deleteOnTermination" : true,
                "status" : "attached",
                "volumeId" : ""
              }
            } ],
            "clientToken" : "",
            "ebsOptimized" : false,
            "enaSupport" : true,
            "hypervisor" : "xen",
            "iamInstanceProfile" : null,
            "instanceLifecycle" : null,
            "elasticGpuAssociations" : null,
            "elasticInferenceAcceleratorAssociations" : null,
            "networkInterfaces" : [ {
              "association" : {
                "carrierIp" : null,
                "ipOwnerId" : "amazon",
                "publicDnsName" : "",
                "publicIp" : ""
              },
              "attachment" : {
                "attachTime" : "2021-11-28T19:50:25Z",
                "attachmentId" : "",
                "deleteOnTermination" : true,
                "deviceIndex" : 0,
                "status" : "attached",
                "networkCardIndex" : 0
              },
              "description" : "",
              "groups" : [ {
                "groupName" : "",
                "groupId" : ""
              } ],
              "ipv6Addresses" : [ ],
              "macAddress" : "",
              "networkInterfaceId" : "",
              "ownerId" : "",
              "privateDnsName" : "",
              "privateIpAddress" : "",
              "privateIpAddresses" : [ {
                "association" : {
                  "carrierIp" : null,
                  "ipOwnerId" : "amazon",
                  "publicDnsName" : "",
                  "publicIp" : ""
                },
                "primary" : true,
                "privateDnsName" : "",
                "privateIpAddress" : ""
              } ],
              "sourceDestCheck" : true,
              "status" : "in-use",
              "subnetId" : "",
              "vpcId" : "",
              "interfaceType" : "interface"
            } ],
            "outpostArn" : null,
            "rootDeviceName" : "/dev/xvda",
            "rootDeviceType" : "ebs",
            "securityGroups" : [ {
              "groupName" : "",
              "groupId" : ""
            } ],
            "sourceDestCheck" : true,
            "spotInstanceRequestId" : null,
            "sriovNetSupport" : null,
            "stateReason" : null,
            "tags" : [ {
              "key" : "Name",
              "value" : ""
            } ],
            "virtualizationType" : "hvm",
            "cpuOptions" : {
              "coreCount" : 1,
              "threadsPerCore" : 1
            },
            "capacityReservationId" : null,
            "capacityReservationSpecification" : {
              "capacityReservationPreference" : "open",
              "capacityReservationTarget" : null
            },
            "hibernationOptions" : {
              "configured" : false
            },
            "licenses" : null,
            "metadataOptions" : {
              "state" : "applied",
              "httpTokens" : "required",
              "httpPutResponseHopLimit" : 1,
              "httpEndpoint" : "enabled"
            },
            "enclaveOptions" : {
              "enabled" : false
            },
            "publicIp" : ""
          },
          "supplementaryConfiguration" : {
            "awsBackupJobs" : [ ]
          },
          "tags" : {
            "Name" : ""
          },
          "discoveryMeta" : { }
    }]